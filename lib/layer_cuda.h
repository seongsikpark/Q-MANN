#include "common.h"
#include <stdio.h>

//#define CUDA_DEBUG true

//bool f_cuda_debug = CUDA_DEBUG;

#define CUDA_NUM_BLOCK      1
#define CUDA_NUM_THREAD     512

#define CUDA_MAX_NUM_THREAD     1024

#define CUDA_ERR(code,func_name) { cuda_assert( func_name, (code) ); }
inline void cuda_assert(cudaError_t code, const char *func_name, bool abort=true)
{
    if(code!=cudaSuccess) {
        fprintf(stderr,"[*E] CUDA : %s : %s\n",func_name,cudaGetErrorString(code));
        if(abort) {
            exit(code);
        }
    }
}

#define CUDA_MCHK(func_name) { cuda_mem_check(func_name); }
inline void cuda_mem_check(const char *func_name) 
{
    size_t free, total;
    cudaMemGetInfo(&free,&total);
    printf("GPU MEM : %30s : %lu KB free of total %lu KB \n",func_name,free/1024,total/1024);
    //printf("GPU MEM : %30s : %lu B free of total %lu B \n",func_name,free,total);
}




// fixed point operation
// wl - 0 to 32
__constant__ int cuda_fixed_max_fixed[33] =
{
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000001,
    0b00000000000000000000000000000011,
    0b00000000000000000000000000000111,
    0b00000000000000000000000000001111,
    0b00000000000000000000000000011111,
    0b00000000000000000000000000111111,
    0b00000000000000000000000001111111,
    0b00000000000000000000000011111111,
    0b00000000000000000000000111111111,
    0b00000000000000000000001111111111,
    0b00000000000000000000011111111111,
    0b00000000000000000000111111111111,
    0b00000000000000000001111111111111,
    0b00000000000000000011111111111111,
    0b00000000000000000111111111111111,
    0b00000000000000001111111111111111,
    0b00000000000000011111111111111111,
    0b00000000000000111111111111111111,
    0b00000000000001111111111111111111,
    0b00000000000011111111111111111111,
    0b00000000000111111111111111111111,
    0b00000000001111111111111111111111,
    0b00000000011111111111111111111111,
    0b00000000111111111111111111111111,
    0b00000001111111111111111111111111,
    0b00000011111111111111111111111111,
    0b00000111111111111111111111111111,
    0b00001111111111111111111111111111,
    0b00011111111111111111111111111111,
    0b00111111111111111111111111111111,
    0b01111111111111111111111111111111
};

// wl - 0 to 32
__constant__ int cuda_fixed_min_fixed[33] =
{
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b11111111111111111111111111111111,
    0b11111111111111111111111111111101,
    0b11111111111111111111111111111001,
    0b11111111111111111111111111110001,
    0b11111111111111111111111111100001,
    0b11111111111111111111111111000001,
    0b11111111111111111111111110000001,
    0b11111111111111111111111100000001,
    0b11111111111111111111111000000001,
    0b11111111111111111111110000000001,
    0b11111111111111111111100000000001,
    0b11111111111111111111000000000001,
    0b11111111111111111110000000000001,
    0b11111111111111111100000000000001,
    0b11111111111111111000000000000001,
    0b11111111111111110000000000000001,
    0b11111111111111100000000000000001,
    0b11111111111111000000000000000001,
    0b11111111111110000000000000000001,
    0b11111111111100000000000000000001,
    0b11111111111000000000000000000001,
    0b11111111110000000000000000000001,
    0b11111111100000000000000000000001,
    0b11111111000000000000000000000001,
    0b11111110000000000000000000000001,
    0b11111100000000000000000000000001,
    0b11111000000000000000000000000001,
    0b11110000000000000000000000000001,
    0b11100000000000000000000000000001,
    0b11000000000000000000000000000001,
    0b10000000000000000000000000000001
};

// iwl - 0 to 31, frac 0 to 31
__constant__ float cuda_fixed_max_float[32][32] =
{
{ 0.000000,0.500000,0.750000,0.875000,0.937500,0.968750,0.984375,0.992188,0.996094,0.998047,0.999023,0.999512,0.999756,0.999878,0.999939,0.999969,0.999985,0.999992,0.999996,0.999998,0.999999,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000 },
{ 1.000000,1.500000,1.750000,1.875000,1.937500,1.968750,1.984375,1.992188,1.996094,1.998047,1.999023,1.999512,1.999756,1.999878,1.999939,1.999969,1.999985,1.999992,1.999996,1.999998,1.999999,2.000000,2.000000,2.000000,2.000000,2.000000,2.000000,2.000000,2.000000,2.000000,2.000000,2.000000 },
{ 3.000000,3.500000,3.750000,3.875000,3.937500,3.968750,3.984375,3.992188,3.996094,3.998047,3.999023,3.999512,3.999756,3.999878,3.999939,3.999969,3.999985,3.999992,3.999996,3.999998,3.999999,4.000000,4.000000,4.000000,4.000000,4.000000,4.000000,4.000000,4.000000,4.000000,4.000000,4.000000 },
{ 7.000000,7.500000,7.750000,7.875000,7.937500,7.968750,7.984375,7.992188,7.996094,7.998047,7.999023,7.999512,7.999756,7.999878,7.999939,7.999969,7.999985,7.999992,7.999996,7.999998,7.999999,8.000000,8.000000,8.000000,8.000000,8.000000,8.000000,8.000000,8.000000,8.000000,8.000000,8.000000 },
{ 15.000000,15.500000,15.750000,15.875000,15.937500,15.968750,15.984375,15.992188,15.996094,15.998047,15.999023,15.999512,15.999756,15.999878,15.999939,15.999969,15.999985,15.999992,15.999996,15.999998,15.999999,16.000000,16.000000,16.000000,16.000000,16.000000,16.000000,16.000000,16.000000,16.000000,16.000000,16.000000 },
{ 31.000000,31.500000,31.750000,31.875000,31.937500,31.968750,31.984375,31.992188,31.996094,31.998047,31.999023,31.999512,31.999756,31.999878,31.999939,31.999969,31.999985,31.999992,31.999996,31.999998,32.000000,32.000000,32.000000,32.000000,32.000000,32.000000,32.000000,32.000000,32.000000,32.000000,32.000000,32.000000 },
{ 63.000000,63.500000,63.750000,63.875000,63.937500,63.968750,63.984375,63.992188,63.996094,63.998047,63.999023,63.999512,63.999756,63.999878,63.999939,63.999969,63.999985,63.999992,63.999996,64.000000,64.000000,64.000000,64.000000,64.000000,64.000000,64.000000,64.000000,64.000000,64.000000,64.000000,64.000000,64.000000 },
{ 127.000000,127.500000,127.750000,127.875000,127.937500,127.968750,127.984375,127.992188,127.996094,127.998047,127.999023,127.999512,127.999756,127.999878,127.999939,127.999969,127.999985,127.999992,128.000000,128.000000,128.000000,128.000000,128.000000,128.000000,128.000000,128.000000,128.000000,128.000000,128.000000,128.000000,128.000000,128.000000 },
{ 255.000000,255.500000,255.750000,255.875000,255.937500,255.968750,255.984375,255.992188,255.996094,255.998047,255.999023,255.999512,255.999756,255.999878,255.999939,255.999969,255.999985,256.000000,256.000000,256.000000,256.000000,256.000000,256.000000,256.000000,256.000000,256.000000,256.000000,256.000000,256.000000,256.000000,256.000000,256.000000 },
{ 511.000000,511.500000,511.750000,511.875000,511.937500,511.968750,511.984375,511.992188,511.996094,511.998047,511.999023,511.999512,511.999756,511.999878,511.999939,511.999969,512.000000,512.000000,512.000000,512.000000,512.000000,512.000000,512.000000,512.000000,512.000000,512.000000,512.000000,512.000000,512.000000,512.000000,512.000000,512.000000 },
{ 1023.000000,1023.500000,1023.750000,1023.875000,1023.937500,1023.968750,1023.984375,1023.992188,1023.996094,1023.998047,1023.999023,1023.999512,1023.999756,1023.999878,1023.999939,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000,1024.000000 },
{ 2047.000000,2047.500000,2047.750000,2047.875000,2047.937500,2047.968750,2047.984375,2047.992188,2047.996094,2047.998047,2047.999023,2047.999512,2047.999756,2047.999878,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000,2048.000000 },
{ 4095.000000,4095.500000,4095.750000,4095.875000,4095.937500,4095.968750,4095.984375,4095.992188,4095.996094,4095.998047,4095.999023,4095.999512,4095.999756,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000,4096.000000 },
{ 8191.000000,8191.500000,8191.750000,8191.875000,8191.937500,8191.968750,8191.984375,8191.992188,8191.996094,8191.998047,8191.999023,8191.999512,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000,8192.000000 },
{ 16383.000000,16383.500000,16383.750000,16383.875000,16383.937500,16383.968750,16383.984375,16383.992188,16383.996094,16383.998047,16383.999023,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000,16384.000000 },
{ 32767.000000,32767.500000,32767.750000,32767.875000,32767.937500,32767.968750,32767.984375,32767.992188,32767.996094,32767.998047,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000,32768.000000 },
{ 65535.000000,65535.500000,65535.750000,65535.875000,65535.937500,65535.968750,65535.984375,65535.992188,65535.996094,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000,65536.000000 },
{ 131071.000000,131071.500000,131071.750000,131071.875000,131071.937500,131071.968750,131071.984375,131071.992188,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000,131072.000000 },
{ 262143.000000,262143.500000,262143.750000,262143.875000,262143.937500,262143.968750,262143.984375,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000,262144.000000 },
{ 524287.000000,524287.500000,524287.750000,524287.875000,524287.937500,524287.968750,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000,524288.000000 },
{ 1048575.000000,1048575.500000,1048575.750000,1048575.875000,1048575.937500,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000,1048576.000000 },
{ 2097151.000000,2097151.500000,2097151.750000,2097151.875000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000,2097152.000000 },
{ 4194303.000000,4194303.500000,4194303.750000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000,4194304.000000 },
{ 8388607.000000,8388607.500000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000,8388608.000000 },
{ 16777215.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000,16777216.000000 },
{ 33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000,33554432.000000 },
{ 67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000,67108864.000000 },
{ 134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000,134217728.000000 },
{ 268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000,268435456.000000 },
{ 536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000,536870912.000000 },
{ 1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000,1073741824.000000 },
{ 2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000,2147483648.000000 }
};

// iwl - 0 to 31, frac 0 to 31
__constant__ float cuda_fixed_min_float[32][32] =
{
{ -0.000000,-0.500000,-0.750000,-0.875000,-0.937500,-0.968750,-0.984375,-0.992188,-0.996094,-0.998047,-0.999023,-0.999512,-0.999756,-0.999878,-0.999939,-0.999969,-0.999985,-0.999992,-0.999996,-0.999998,-0.999999,-1.000000,-1.000000,-1.000000,-1.000000,-1.000000,-1.000000,-1.000000,-1.000000,-1.000000,-1.000000,-1.000000 },
{ -1.000000,-1.500000,-1.750000,-1.875000,-1.937500,-1.968750,-1.984375,-1.992188,-1.996094,-1.998047,-1.999023,-1.999512,-1.999756,-1.999878,-1.999939,-1.999969,-1.999985,-1.999992,-1.999996,-1.999998,-1.999999,-2.000000,-2.000000,-2.000000,-2.000000,-2.000000,-2.000000,-2.000000,-2.000000,-2.000000,-2.000000,-2.000000 },
{ -3.000000,-3.500000,-3.750000,-3.875000,-3.937500,-3.968750,-3.984375,-3.992188,-3.996094,-3.998047,-3.999023,-3.999512,-3.999756,-3.999878,-3.999939,-3.999969,-3.999985,-3.999992,-3.999996,-3.999998,-3.999999,-4.000000,-4.000000,-4.000000,-4.000000,-4.000000,-4.000000,-4.000000,-4.000000,-4.000000,-4.000000,-4.000000 },
{ -7.000000,-7.500000,-7.750000,-7.875000,-7.937500,-7.968750,-7.984375,-7.992188,-7.996094,-7.998047,-7.999023,-7.999512,-7.999756,-7.999878,-7.999939,-7.999969,-7.999985,-7.999992,-7.999996,-7.999998,-7.999999,-8.000000,-8.000000,-8.000000,-8.000000,-8.000000,-8.000000,-8.000000,-8.000000,-8.000000,-8.000000,-8.000000 },
{ -15.000000,-15.500000,-15.750000,-15.875000,-15.937500,-15.968750,-15.984375,-15.992188,-15.996094,-15.998047,-15.999023,-15.999512,-15.999756,-15.999878,-15.999939,-15.999969,-15.999985,-15.999992,-15.999996,-15.999998,-15.999999,-16.000000,-16.000000,-16.000000,-16.000000,-16.000000,-16.000000,-16.000000,-16.000000,-16.000000,-16.000000,-16.000000 },
{ -31.000000,-31.500000,-31.750000,-31.875000,-31.937500,-31.968750,-31.984375,-31.992188,-31.996094,-31.998047,-31.999023,-31.999512,-31.999756,-31.999878,-31.999939,-31.999969,-31.999985,-31.999992,-31.999996,-31.999998,-32.000000,-32.000000,-32.000000,-32.000000,-32.000000,-32.000000,-32.000000,-32.000000,-32.000000,-32.000000,-32.000000,-32.000000 },
{ -63.000000,-63.500000,-63.750000,-63.875000,-63.937500,-63.968750,-63.984375,-63.992188,-63.996094,-63.998047,-63.999023,-63.999512,-63.999756,-63.999878,-63.999939,-63.999969,-63.999985,-63.999992,-63.999996,-64.000000,-64.000000,-64.000000,-64.000000,-64.000000,-64.000000,-64.000000,-64.000000,-64.000000,-64.000000,-64.000000,-64.000000,-64.000000 },
{ -127.000000,-127.500000,-127.750000,-127.875000,-127.937500,-127.968750,-127.984375,-127.992188,-127.996094,-127.998047,-127.999023,-127.999512,-127.999756,-127.999878,-127.999939,-127.999969,-127.999985,-127.999992,-128.000000,-128.000000,-128.000000,-128.000000,-128.000000,-128.000000,-128.000000,-128.000000,-128.000000,-128.000000,-128.000000,-128.000000,-128.000000,-128.000000 },
{ -255.000000,-255.500000,-255.750000,-255.875000,-255.937500,-255.968750,-255.984375,-255.992188,-255.996094,-255.998047,-255.999023,-255.999512,-255.999756,-255.999878,-255.999939,-255.999969,-255.999985,-256.000000,-256.000000,-256.000000,-256.000000,-256.000000,-256.000000,-256.000000,-256.000000,-256.000000,-256.000000,-256.000000,-256.000000,-256.000000,-256.000000,-256.000000 },
{ -511.000000,-511.500000,-511.750000,-511.875000,-511.937500,-511.968750,-511.984375,-511.992188,-511.996094,-511.998047,-511.999023,-511.999512,-511.999756,-511.999878,-511.999939,-511.999969,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000,-512.000000 },
{ -1023.000000,-1023.500000,-1023.750000,-1023.875000,-1023.937500,-1023.968750,-1023.984375,-1023.992188,-1023.996094,-1023.998047,-1023.999023,-1023.999512,-1023.999756,-1023.999878,-1023.999939,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000,-1024.000000 },
{ -2047.000000,-2047.500000,-2047.750000,-2047.875000,-2047.937500,-2047.968750,-2047.984375,-2047.992188,-2047.996094,-2047.998047,-2047.999023,-2047.999512,-2047.999756,-2047.999878,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000,-2048.000000 },
{ -4095.000000,-4095.500000,-4095.750000,-4095.875000,-4095.937500,-4095.968750,-4095.984375,-4095.992188,-4095.996094,-4095.998047,-4095.999023,-4095.999512,-4095.999756,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000,-4096.000000 },
{ -8191.000000,-8191.500000,-8191.750000,-8191.875000,-8191.937500,-8191.968750,-8191.984375,-8191.992188,-8191.996094,-8191.998047,-8191.999023,-8191.999512,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000,-8192.000000 },
{ -16383.000000,-16383.500000,-16383.750000,-16383.875000,-16383.937500,-16383.968750,-16383.984375,-16383.992188,-16383.996094,-16383.998047,-16383.999023,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000,-16384.000000 },
{ -32767.000000,-32767.500000,-32767.750000,-32767.875000,-32767.937500,-32767.968750,-32767.984375,-32767.992188,-32767.996094,-32767.998047,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000,-32768.000000 },
{ -65535.000000,-65535.500000,-65535.750000,-65535.875000,-65535.937500,-65535.968750,-65535.984375,-65535.992188,-65535.996094,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000,-65536.000000 },
{ -131071.000000,-131071.500000,-131071.750000,-131071.875000,-131071.937500,-131071.968750,-131071.984375,-131071.992188,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000,-131072.000000 },
{ -262143.000000,-262143.500000,-262143.750000,-262143.875000,-262143.937500,-262143.968750,-262143.984375,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000,-262144.000000 },
{ -524287.000000,-524287.500000,-524287.750000,-524287.875000,-524287.937500,-524287.968750,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000,-524288.000000 },
{ -1048575.000000,-1048575.500000,-1048575.750000,-1048575.875000,-1048575.937500,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000,-1048576.000000 },
{ -2097151.000000,-2097151.500000,-2097151.750000,-2097151.875000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000,-2097152.000000 },
{ -4194303.000000,-4194303.500000,-4194303.750000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000,-4194304.000000 },
{ -8388607.000000,-8388607.500000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000,-8388608.000000 },
{ -16777215.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000,-16777216.000000 },
{ -33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000,-33554432.000000 },
{ -67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000,-67108864.000000 },
{ -134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000,-134217728.000000 },
{ -268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000,-268435456.000000 },
{ -536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000,-536870912.000000 },
{ -1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000,-1073741824.000000 },
{ -2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000,-2147483648.000000 }
};

/*
#define CUDA_FIXED_MAX_FIXED(wl) cuda_fixed_max_fixed[wl]
#define CUDA_FIXED_MIN_FIXED(wl) cuda_fixed_min_fixed[wl]

#define CUDA_FIXED_MAX_FLOAT(iwl,frac) cuda_fixed_max_float[iwl][frac]
#define CUDA_FIXED_MIN_FLOAT(iwl,frac) cuda_fixed_min_float[iwl][frac]

#define CUDA_FIXED_OVERFLOW_F(x,iwl,frac) (((x)<=cuda_fixed_max_float[iwl][frac])? (((x)>=cuda_fixed_min_float[iwl][frac])? 1.0:0.0):0.0)
#define CUDA_FIXED_OVERFLOW_B(x,iwl,frac) (((x)<=cuda_fixed_max_float[iwl][frac])? (((x)>=cuda_fixed_min_float[iwl][frac])? false:true):true)

// 2's complement
#define _CUDA_FLOAT2FIXED(x,iwl,frac) (((x)>(cuda_fixed_max_float[iwl][frac]))? cuda_fixed_max_fixed[iwl+frac+1]:(((x)<(cuda_fixed_min_float[iwl][frac]))? cuda_fixed_min_fixed[iwl+frac+1]:(int)((x)*(1<<frac))))

// fixed point representation
#define CUDA_FLOAT2FIXED(x,iwl,frac) (((x)>=0.0)? _CUDA_FLOAT2FIXED(x,iwl,frac)&0x7FFFFFFFF : (~_CUDA_FLOAT2FIXED(x,iwl,frac)+1)|0x80000000)
#define CUDA_FIXED2FLOAT(x,iwl,frac) (((x&0x80000000)==0x00000000)? (float)((float)(x)/(1<<frac)) : (float)((float)(~((int)(x)&0x7FFFFFFF)+1)/(1<<frac)) )
*/



#define CUDA_FIXED_MAX_FIXED(iwl,frac) (int)((unsigned int)(1<<(iwl+frac))-1)
#define CUDA_FIXED_MIN_FIXED(iwl,frac) (int)(-1*(CUDA_FIXED_MAX_FIXED(iwl,frac)))

#define CUDA_FIXED_MAX_FLOAT(iwl,frac) (float)((float)(CUDA_FIXED_MAX_FIXED(iwl,frac))/(float)(1<<frac))
#define CUDA_FIXED_MIN_FLOAT(iwl,frac) (float)(-1*(CUDA_FIXED_MAX_FLOAT(iwl,frac)))

// check over & under flow
#define CUDA_FIXED_OVERFLOW_F(x,iwl,frac) (((x)<=CUDA_FIXED_MAX_FLOAT(iwl,frac))? (((x)>=CUDA_FIXED_MIN_FLOAT(iwl,frac))? 1.0:0.0):0.0)
#define CUDA_FIXED_OVERFLOW_B(x,iwl,frac) (((x)<=CUDA_FIXED_MAX_FLOAT(iwl,frac))? (((x)>=CUDA_FIXED_MIN_FLOAT(iwl,frac))? false:true):true)

//__device__ int (*_float2int_list_d[4])(float) =
//__DEVICE_FUNCTIONS_DECL__ int (*_float2int_list_d[4])(float) =
//{
//    __float2int_rd,     // round down
//    __float2int_ru,     // round up
//    __float2int_rn,     // round to nerest even
//    __float2int_rz      // round towards zero
//};


// 2's complement
#ifdef EN_QUANT_MODE
    //#define _CUDA_FLOAT2FIXED(x,iwl,frac,mode) (((x)>CUDA_FIXED_MAX_FLOAT(iwl,frac))? CUDA_FIXED_MAX_FIXED(iwl,frac):(((x)<CUDA_FIXED_MIN_FLOAT(iwl,frac))? CUDA_FIXED_MIN_FIXED(iwl,frac):_float2int_list_d[mode]((x)*(1<<frac))))
    #define _CUDA_FLOAT2FIXED(x,iwl,frac,mode) (((x)>CUDA_FIXED_MAX_FLOAT(iwl,frac))? CUDA_FIXED_MAX_FIXED(iwl,frac):(((x)<CUDA_FIXED_MIN_FLOAT(iwl,frac))? CUDA_FIXED_MIN_FIXED(iwl,frac):__float2int_rd((x)*(1<<frac))))
#else
    // only f_mode=3
    #define _CUDA_FLOAT2FIXED(x,iwl,frac,mode) (((x)>CUDA_FIXED_MAX_FLOAT(iwl,frac))? CUDA_FIXED_MAX_FIXED(iwl,frac):(((x)<CUDA_FIXED_MIN_FLOAT(iwl,frac))? CUDA_FIXED_MIN_FIXED(iwl,frac):(int)((x)*(1<<frac))))
#endif

// old
//#define _CUDA_FLOAT2FIXED(x,iwl,frac) (((x)>CUDA_FIXED_MAX_FLOAT(iwl,frac))? CUDA_FIXED_MAX_FIXED(iwl,frac):(((x)<CUDA_FIXED_MIN_FLOAT(iwl,frac))? CUDA_FIXED_MIN_FIXED(iwl,frac):(int)((x)*(1<<frac))))
// quantization - ceiling
//#define _CUDA_FLOAT2FIXED(x,iwl,frac) (((x)>CUDA_FIXED_MAX_FLOAT(iwl,frac))? CUDA_FIXED_MAX_FIXED(iwl,frac):(((x)<CUDA_FIXED_MIN_FLOAT(iwl,frac))? CUDA_FIXED_MIN_FIXED(iwl,frac):(int)((x)*(1<<frac))+1))
// quantization - round nearest
//#define _CUDA_FLOAT2FIXED(x,iwl,frac) (((x+0.5)>CUDA_FIXED_MAX_FLOAT(iwl,frac))? CUDA_FIXED_MAX_FIXED(iwl,frac):(((x)<CUDA_FIXED_MIN_FLOAT(iwl,frac))? CUDA_FIXED_MIN_FIXED(iwl,frac):(int)((float)((x)*(1<<frac))+0.5)))
//#define _CUDA_FLOAT2FIXED(x,iwl,frac) (((x)>CUDA_FIXED_MAX_FLOAT(iwl,frac))? CUDA_FIXED_MAX_FIXED(iwl,frac):(((x)<CUDA_FIXED_MIN_FLOAT(iwl,frac))? CUDA_FIXED_MIN_FIXED(iwl,frac):(int)(floorf((float)((x)*(1<<frac))))))
//#define _CUDA_FLOAT2FIXED(x,iwl,frac) (((x)>CUDA_FIXED_MAX_FLOAT(iwl,frac))? CUDA_FIXED_MAX_FIXED(iwl,frac):(((x)<CUDA_FIXED_MIN_FLOAT(iwl,frac))? CUDA_FIXED_MIN_FIXED(iwl,frac):__float2int_rn((x)*(1<<frac))))
//#define _CUDA_FLOAT2FIXED(x,iwl,frac) (((x)>CUDA_FIXED_MAX_FLOAT(iwl,frac))? CUDA_FIXED_MAX_FIXED(iwl,frac):(((x)<CUDA_FIXED_MIN_FLOAT(iwl,frac))? CUDA_FIXED_MIN_FIXED(iwl,frac):(int)(floorf((float)((1.3))))))

#define CUDA_FLOAT2FIXED(x,iwl,frac,mode) (((x)>=0.0)? _CUDA_FLOAT2FIXED(x,iwl,frac,mode)&0x7FFFFFFFF : (~_CUDA_FLOAT2FIXED(x,iwl,frac,mode)+1)|0x80000000)
#define CUDA_FIXED2FLOAT(x,iwl,frac) (((x&0x80000000)==0x00000000)? (float)((float)(x)/(1<<frac)) : (float)((float)(~((int)(x)&0x7FFFFFFF)+1)/(1<<frac)) )



//#define FLOAT_QUANT(x) (FIXED2FLOAT(FLOAT2FIXED(x)))
// including binary
#define CUDA_FLOAT_QUANT(x,iwl,frac,mode) (((iwl+frac)==0)? ((x>=0.0)? 1.0:-1.0) : (CUDA_FIXED2FLOAT(CUDA_FLOAT2FIXED(x,iwl,frac,mode),iwl,frac)))
//#define FLOAT_QUANT(x,iwl,frac) (x)

//
#define CUDA_FIXED_ADD(out,a,b,iwl_a,frac_a,iwl_b,frac_b,mode) (out=CUDA_FLOAT_QUANT(CUDA_FLOAT_QUANT(a,iwl_a,frac_a,mode)+CUDA_FLOAT_QUANT(b,iwl_b,frac_b,mode),iwl_a,frac_a,mode))
#define CUDA_FIXED_MUL(out,a,b,iwl_a,frac_a,iwl_b,frac_b,mode) (out=CUDA_FLOAT_QUANT(CUDA_FLOAT_QUANT(a,iwl_a,frac_a,mode)*CUDA_FLOAT_QUANT(b,iwl_b,frac_b,mode),iwl_a,frac_a,mode))
#define CUDA_FIXED_MAC(out,a,b,iwl_a,frac_a,iwl_b,frac_b,mode) (out=out+CUDA_FLOAT_QUANT(CUDA_FLOAT_QUANT(a,iwl_a,frac_a,mode)*CUDA_FLOAT_QUANT(b,iwl_b,frac_b,mode),iwl_a,frac_a,mode))


